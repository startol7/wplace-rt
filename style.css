:root{
  --bg:#0f172a;
  --panel:#131c2f;
  --text:#e7ecf3;
  --muted:#9fb0c7;
  --brand:#60a5fa;
  --accent:#7c3aed;
  --line:#22314f;
  --btn:#1f2a44;
  --btn-active:#33476f;
  --success:#22c55e;
  --danger:#ef4444;
  --shadow:0 4px 12px rgba(0,0,0,0.3);
  --radius:14px;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;overflow:hidden}
body{
  background:var(--bg);
  color:var(--text);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* Topbar */
.topbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 16px;border-bottom:1px solid var(--line);
  background:linear-gradient(180deg,#0e1627,#0b1321);
  position:sticky;top:0;z-index:1000;
  height:60px;
}
.brand{font-weight:700;color:var(--brand);font-size:18px}
.controls{display:flex;gap:10px;align-items:center}
.country-label{display:flex;gap:8px;align-items:center;color:var(--muted)}
.country-label-text{display:inline}
.country-label select{
  background:var(--panel);color:var(--text);border:1px solid var(--line);
  border-radius:8px;padding:6px 10px;font-size:14px;
  appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239fb0c7' d='M6 9L2 5h8z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 8px center;
  padding-right:28px;
}

.btn{
  background:var(--btn);color:var(--text);border:1px solid var(--line);
  border-radius:8px;padding:6px 12px;cursor:pointer;font-size:14px;
  transition:all 0.2s;font-weight:500;
}
.btn:hover{background:var(--btn-active);transform:translateY(-1px)}
.btn:active{transform:translateY(0)}
.hidden{display:none!important}

/* Main Layout */
.main{
  display:grid;grid-template-columns:1fr 360px;gap:14px;
  padding:14px;height:calc(100vh - 60px);position:relative;
}

/* Map */
.map-wrap{
  background:var(--panel);border:1px solid var(--line);
  border-radius:var(--radius);overflow:hidden;position:relative;
}
#map{width:100%;height:100%}

/* Mobile Controls (hidden on desktop) */
.mobile-controls{display:none}
.mobile-bottom-sheet{display:none}

/* Desktop Sidebar */
.desktop-side{display:flex;flex-direction:column;gap:14px;overflow-y:auto;overflow-x:hidden}
.card{
  background:var(--panel);border:1px solid var(--line);
  border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);
}
.card-title{font-weight:700;margin-bottom:8px;font-size:16px}
.sub-title{color:var(--muted);margin:12px 0 6px;font-size:13px;text-transform:uppercase;letter-spacing:0.5px}

/* Segments */
.seg{display:flex;gap:8px;flex-wrap:wrap}
.seg-btn{
  background:var(--btn);color:var(--text);border:1px solid var(--line);
  border-radius:10px;padding:6px 12px;cursor:pointer;font-size:14px;
  transition:all 0.2s;font-weight:500;
}
.seg-btn:hover{background:var(--btn-active);transform:translateY(-1px)}
.seg-btn.active{
  background:var(--btn-active);box-shadow:inset 0 0 0 2px rgba(0,0,0,0.2);
  transform:none;
}

/* Ranking */
.ranking{list-style:none;padding:0;margin:10px 0 0;max-height:220px;overflow:auto}
.ranking li{
  display:flex;justify-content:space-between;
  border-bottom:1px dashed var(--line);padding:8px 0;
  transition:background 0.2s;
}
.ranking li:hover{background:rgba(96,165,250,0.05)}
.ranking li span{color:var(--muted)}
.ranking li strong{font-weight:800;color:var(--brand)}

/* Statistics */
.stat-row{
  display:flex;justify-content:space-between;padding:8px 0;
  border-bottom:1px dashed var(--line);
}
.stat-row strong{color:var(--brand);font-weight:700}

/* Color Controls */
.color-row{display:flex;align-items:center;gap:10px;margin-top:8px}
.color-hex{
  width:110px;background:var(--panel);border:1px solid var(--line);
  border-radius:8px;color:var(--text);padding:6px 8px;font-size:14px;
}
.color-picker{
  width:46px;height:34px;border:none;border-radius:8px;
  overflow:hidden;cursor:pointer;
}

/* Tile Custom */
.tile-custom{display:flex;gap:8px;margin-top:8px}
.tile-custom input{
  flex:1;background:var(--panel);border:1px solid var(--line);
  border-radius:8px;color:var(--text);padding:6px 8px;font-size:14px;
}

/* Cooldown */
.cooldown{
  position:relative;height:10px;background:#111a2b;
  border:1px solid var(--line);border-radius:6px;overflow:hidden;
}
.cooldown-fill{
  position:absolute;left:0;top:0;bottom:0;
  background:linear-gradient(90deg,#10b981,#60a5fa);
  transition:width 0.1s linear;
}
.cooldown-text{margin-top:6px;color:var(--muted);font-size:14px}
.note{color:var(--muted);margin:8px 0 0;font-size:13px;line-height:1.4}

/* Toast */
.toast-container{
  position:fixed;top:80px;left:50%;transform:translateX(-50%);
  z-index:9999;display:flex;flex-direction:column;gap:10px;
  pointer-events:none;
}
.toast{
  background:var(--panel);color:var(--text);padding:10px 16px;
  border:1px solid var(--line);border-radius:10px;
  box-shadow:var(--shadow);font-size:14px;
  animation:slideDown 0.3s ease;pointer-events:auto;
}
@keyframes slideDown{
  from{transform:translateY(-20px);opacity:0}
  to{transform:translateY(0);opacity:1}
}

/* About link */
.about-link{
  display:block;color:var(--brand);text-decoration:none;
  padding:8px 0;transition:color 0.2s;
}
.about-link:hover{color:var(--accent)}
.about-link-mobile{
  display:inline-block;margin-top:12px;color:var(--brand);
  text-decoration:none;font-size:14px;
}

/* Mobile Styles */
@media (max-width: 768px){
  body{overflow:hidden}
  
  .topbar{
    padding:8px 12px;height:50px;
  }
  .brand-title{font-size:16px}
  .country-label-text{display:none}
  .country-label select{padding:5px 24px 5px 8px;font-size:13px}
  .btn{padding:5px 10px;font-size:13px}
  
  .main{
    grid-template-columns:1fr;
    padding:0;gap:0;
    height:calc(100vh - 50px);
  }
  
  .desktop-side{display:none}
  
  .map-wrap{
    border-radius:0;border:none;
    height:calc(100vh - 50px - 180px);
  }
  
  /* Mobile Controls */
  .mobile-controls{
    display:block;position:absolute;bottom:20px;right:20px;
    z-index:500;
  }
  
  .quick-color-picker{
    display:flex;align-items:center;gap:10px;
    background:var(--panel);padding:10px 14px;
    border-radius:25px;border:1px solid var(--line);
    box-shadow:var(--shadow);backdrop-filter:blur(10px);
    background:rgba(19,28,47,0.95);
  }
  
  .mobile-color-picker{
    width:40px;height:40px;border:2px solid var(--line);
    border-radius:50%;cursor:pointer;
  }
  
  .brush-indicator{
    color:var(--text);font-weight:600;font-size:14px;
    background:var(--btn);padding:4px 10px;border-radius:12px;
  }
  
  /* Mobile Bottom Sheet */
  .mobile-bottom-sheet{
    display:block;position:fixed;bottom:0;left:0;right:0;
    background:var(--panel);border-top:1px solid var(--line);
    border-radius:20px 20px 0 0;height:180px;
    box-shadow:0 -4px 20px rgba(0,0,0,0.3);
    z-index:600;transition:height 0.3s ease;
  }
  
  .mobile-bottom-sheet.expanded{height:60vh;overflow-y:auto}
  
  .sheet-handle{
    width:40px;height:4px;background:var(--line);
    border-radius:2px;margin:10px auto 8px;cursor:grab;
  }
  
  .sheet-tabs{
    display:flex;justify-content:space-around;
    border-bottom:1px solid var(--line);padding:0 10px;
  }
  
  .sheet-tab{
    flex:1;background:none;border:none;color:var(--muted);
    padding:10px 5px;font-size:12px;cursor:pointer;
    border-bottom:2px solid transparent;transition:all 0.2s;
  }
  
  .sheet-tab.active{
    color:var(--brand);border-bottom-color:var(--brand);
    font-weight:600;
  }
  
  .sheet-content{padding:12px;height:calc(100% - 60px);overflow-y:auto}
  
  .sheet-panel{display:none}
  .sheet-panel.active{display:block;animation:fadeIn 0.3s ease}
  
  @keyframes fadeIn{
    from{opacity:0}to{opacity:1}
  }
  
  /* Mobile Ranking */
  .mobile-ranking{max-height:none;margin:8px 0 0}
  .seg.compact{margin-bottom:8px}
  
  /* Mobile Stats */
  .stat-grid{
    display:grid;grid-template-columns:repeat(3,1fr);gap:10px;
  }
  
  .stat-card{
    background:var(--btn);padding:12px 8px;border-radius:12px;
    text-align:center;border:1px solid var(--line);
  }
  
  .stat-value{
    font-size:20px;font-weight:800;color:var(--brand);
    margin-bottom:4px;
  }
  
  .stat-label{font-size:11px;color:var(--muted);line-height:1.2}
  
  /* Mobile Brush Panel */
  .brush-section,.color-section,.tile-section{margin-bottom:16px}
  
  .color-presets{
    display:grid;grid-template-columns:repeat(8,1fr);gap:8px;
    margin:8px 0;
  }
  
  .color-preset{
    width:36px;height:36px;border-radius:50%;border:2px solid var(--line);
    cursor:pointer;transition:transform 0.2s;
  }
  
  .color-preset:active{transform:scale(0.9)}
  .color-preset.active{border-color:var(--brand);box-shadow:0 0 0 3px rgba(96,165,250,0.3)}
  
  .color-row.mobile{margin-top:8px}
  
  /* Mobile Cooldown */
  .cooldown-display{text-align:center;padding:10px}
  
  .mobile-cooldown{
    width:100%;height:20px;margin-bottom:12px;border-radius:10px;
  }
  
  .cooldown-time{
    font-size:28px;font-weight:800;color:var(--brand);margin-bottom:8px;
  }
  
  .cooldown-details{
    display:flex;justify-content:center;gap:15px;
    color:var(--muted);font-size:13px;
  }
  
  /* Toast on mobile */
  .toast-container{top:60px}
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1024px){
  .main{grid-template-columns:1fr 320px}
  .card{padding:12px}
  .card-title{font-size:15px}
}

/* Landscape mobile */
@media (max-width: 768px) and (orientation: landscape){
  .mobile-bottom-sheet{height:120px}
  .mobile-bottom-sheet.expanded{height:50vh}
  .map-wrap{height:calc(100vh - 50px - 120px)}
}

/* PWA safe areas */
@supports (padding: max(0px)){
  .topbar{padding-top:max(12px,env(safe-area-inset-top))}
  .mobile-bottom-sheet{padding-bottom:max(0px,env(safe-area-inset-bottom))}
}

/* Leaflet customizations */
.leaflet-control-zoom{
  border:1px solid var(--line)!important;
  background:var(--panel)!important;
  box-shadow:var(--shadow)!important;
}
.leaflet-control-zoom a{
  background:var(--panel)!important;
  color:var(--text)!important;
  border-bottom:1px solid var(--line)!important;
}
.leaflet-control-zoom a:hover{background:var(--btn)!important}
.leaflet-control-attribution{
  background:rgba(15,23,42,0.8)!important;
  color:var(--muted)!important;
  font-size:11px!important;
}