:root{
  --bg:#0d1420; --panel:#121a28; --text:#e6edf7; --muted:#9fb2cc;
  --brand:#79c0ff; --accent:#3b82f6; --line:#1f2a3a;
  --header-h: 50px;    /* モバイルのヘッダー高さ */
}

/* ベース */
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif}

/* ヘッダー（薄く） */
.floating-bar{
  position:fixed; top:6px; left:6px; right:6px; z-index:1000;
  background:rgba(18,26,40,.9); backdrop-filter:blur(8px);
  border:1px solid var(--line); border-radius:12px;
  padding:6px 8px; display:flex; align-items:center; gap:8px;
}
.brand{font-weight:700;color:var(--brand)}
.spacer{flex:1 1 auto}
.country-pill{display:flex;align-items:center;gap:6px;background:#0f1724;border:1px solid var(--line);border-radius:999px;padding:4px 8px}
.country-pill .label{color:var(--muted)}
.country-pill select{appearance:none;background:transparent;color:var(--text);border:none;outline:none}
.pill-btn{background:var(--accent);color:#fff;border:none;border-radius:999px;padding:6px 10px;font-weight:600}

/* パネル */
.info-panels{max-width:1100px;margin:calc(var(--header-h) + 14px) auto 10px;padding:0 10px}
.info-panels details{
  background:var(--panel); border:1px solid var(--line); border-radius:12px;
  margin:8px 0; overflow:hidden;
}
.info-panels summary{
  padding:12px 14px; cursor:pointer; list-style:none; font-weight:700;
}
.info-panels summary::-webkit-details-marker{display:none}
.ranking-list{list-style:none;padding:0;margin:6px 0 12px}
.ranking-list li{display:flex;justify-content:space-between;padding:8px 14px;border-top:1px solid var(--line)}
.stats{padding:8px 14px 14px}
.stat-row{display:flex;justify-content:space-between;padding:8px 0;border-top:1px solid var(--line)}
.stat-row span{color:var(--muted)}

.controls-box{padding:10px 14px 14px}
.row{display:flex;align-items:center;gap:10px;margin:8px 0;flex-wrap:wrap}
.row-label{color:var(--muted);min-width:48px}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
.color-chip{width:44px;height:44px;border:1px solid var(--line);border-radius:8px;background:#1f2937;display:grid;place-items:center}
.color-chip input[type=color]{width:34px;height:34px;border:none;background:none;padding:0;border-radius:6px}
.seg{display:flex;gap:8px;flex-wrap:wrap}
.seg-btn{background:#0e1623;color:#cbd5e1;border:1px solid var(--line);border-radius:8px;padding:6px 10px;cursor:pointer}
.seg-btn.active{background:#22324d;color:#fff;border-color:#2c3f64}
.btn.small{padding:8px 12px;border:none;border-radius:10px;background:#3b82f6;color:#fff}
.note{color:var(--muted)}

/* 地図（PCデフォルト：大きめ） */
#mapWrap{max-width:1100px;margin:0 auto;padding:0 10px 16px;position:relative}
#map{
  width:100%; height:70vh; min-height:420px;
  border:1px solid var(--line); border-radius:12px; background:#0b1220;
  position:relative; z-index:5; /* 最前面 */
}

/* クールダウン */
.cooldown{
  position:absolute; right:14px; bottom:14px; width:180px; height:24px;
  background:#101826; border:1px solid var(--line); border-radius:999px;
  overflow:hidden; display:flex; align-items:center; padding:0 8px; color:#fff;
  pointer-events:none; /* 操作不要なので透過 */
}
.cooldown.hidden{display:none}
.cooldown .bar{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#3b82f6,#22c55e);opacity:.3}
.cooldown #cooldownText{position:absolute;right:8px;top:-18px;font-size:12px}

/* ===== スマホ：上UI／下に地図を常時表示 ===== */
@media (max-width: 640px){
  .floating-bar{top:6px;left:6px;right:6px;padding:6px 8px}
  .country-pill .label{display:none}
  .country-pill select{max-width:42vw;font-size:.95rem}

  .panels-mobile-order{padding:calc(var(--header-h) + 8px) 8px 8px}

  /* 地図を下に“常時”表示：100*--vh からヘッダー＆少しの余白を引く */
  .map-stick-bottom{position:sticky;bottom:0;background:var(--bg);z-index:1}
  #map{
    height:calc((var(--vh, 1vh)*100) - var(--header-h) - 180px);
    min-height:320px;
    border-radius:12px 12px 0 0;
  }
}

/* ===== タッチ透過：地図にタップを通す（必要な子だけ有効） ===== */
.floating-bar,
.cooldown {
  pointer-events: none;
}
.floating-bar * { pointer-events: auto; } /* 国選択・ボタンは触れる */

/* Leaflet のタッチ挙動を明示 */
.leaflet-container{
  touch-action: pan-x pan-y;
  -ms-touch-action: pan-x pan-y;
}