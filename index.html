<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TePlace â€” Real World Map Conquest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="style.css" />
  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
    defer
  ></script>
</head>
<body>

  <!-- ç”»é¢æœ€ä¸Šéƒ¨ã«æµ®ã‹ã›ã‚‹æ¥µå°ãƒãƒ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«å„ªå…ˆï¼‰ -->
  <header class="floating-bar">
    <div class="brand">ğŸŒ TePlace</div>
    <div class="inline-controls">
      <label class="country-pill" title="Your country">
        <span class="label">Country</span>
        <select id="countrySelect" aria-label="Your country">
          <!-- JSã§è¿½åŠ ï¼ˆæ—¢å­˜ã®COUNTRY_LISTã§ã‚‚OKï¼‰ -->
          <option value="Japan">Japan</option>
          <option value="United States">United States</option>
          <option value="Korea">Korea</option>
          <option value="China">China</option>
          <option value="United Kingdom">United Kingdom</option>
          <option value="France">France</option>
          <option value="Germany">Germany</option>
          <option value="Brazil">Brazil</option>
          <option value="India">India</option>
          <option value="Russia">Russia</option>
          <option value="Canada">Canada</option>
          <option value="Australia">Australia</option>
        </select>
      </label>

      <button id="signBtn" class="pill-btn" type="button">Sign in</button>
    </div>
  </header>

  <!-- åœ°å›³ï¼ˆå…¨ç”»é¢ï¼‰ -->
  <main id="mapWrap">
    <div id="map" role="region" aria-label="Game map"></div>

    <!-- ãƒãƒƒãƒ—å³ä¸‹ã®å°ã•ãªè‰²ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆå¿…è¦æœ€ä½é™ã ã‘é‡ã­ã‚‹ï¼‰ -->
    <div class="map-overlay bottom-right stack">
      <label class="color-chip">
        <input type="color" id="colorPicker" aria-label="Color" />
      </label>

      <!-- ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒãƒ¼ï¼ˆå¿…è¦æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
      <div id="cooldown" class="cooldown hidden" aria-live="polite">
        <div id="cooldownFill" class="bar"></div>
        <span id="cooldownText" class="t"></span>
      </div>
    </div>
  </main>

  <!-- æƒ…å ±ãƒ‘ãƒãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŠ˜ã‚ŠãŸãŸã¿ã€‚é–‹ãã¨ãã ã‘ç¸¦ã«å±•é–‹ -->
  <section class="info-panels">
    <details>
      <summary>ğŸ† World Ranking</summary>
      <div class="seg">
        <button class="seg-btn active" data-period="today">Today</button>
        <button class="seg-btn" data-period="week">Week</button>
        <button class="seg-btn" data-period="month">Month</button>
      </div>
      <ul id="rankingList" class="ranking"></ul>
    </details>

    <details>
      <summary>ğŸ“Š Statistics</summary>
      <div class="stats-grid">
        <div><small>Total territories</small><strong id="statTotal">0</strong></div>
        <div><small>My territories</small><strong id="statMine">0</strong></div>
        <div><small>Online (approx)</small><strong id="statOnline">0</strong></div>
      </div>
    </details>

    <details>
      <summary>ğŸ¨ Color & Tile size</summary>
      <div class="control-block">
        <div class="row">
          <input id="colorHex" class="mono" type="text" value="#ff4b4b" />
          <label class="color-chip">
            <input type="color" id="colorPicker2" />
          </label>
        </div>
        <div class="seg">
          <button class="seg-btn" data-tile="0.005">0.005Â°</button>
          <button class="seg-btn" data-tile="0.001">0.001Â°</button>
          <button class="seg-btn active" data-tile="0.0005">0.0005Â°</button>
        </div>
        <div class="row">
          <input id="tileCustom" class="mono" type="number" step="0.0001" min="0.00001" value="0.0005" />
          <button id="tileApply" class="btn small" type="button">Apply</button>
        </div>
        <small>1Ã—1 only ãƒ» Cooldown: <b>10s</b></small>
      </div>
    </details>
  </section>

  <script>
    // ====== 100vh å•é¡Œã‚’å›é¿ï¼šåœ°å›³ã‚’å¸¸ã«ç«¯æœ«ã®è¦‹ãˆã‚‹é«˜ã•ã« ======
    function setMapHeight() {
      const h = window.innerHeight;           // ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼è¾¼ã¿ã®å®Ÿé«˜ã•
      document.getElementById('map').style.height = h + 'px';
      // Leaflet ãŒèª­ã¿è¾¼ã¿æ¸ˆã¿ãªã‚‰ã‚µã‚¤ã‚ºæ›´æ–°
      if (window.L && window.map) { setTimeout(()=> map.invalidateSize(), 0); }
    }
    window.addEventListener('resize', setMapHeight);
    window.addEventListener('orientationchange', setMapHeight);
    document.addEventListener('DOMContentLoaded', setMapHeight);

    // ====== æ—¢å­˜ã® JS ã¨æ¥ç¶šï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ ======
    // 1) ã‚µã‚¤ãƒ³ãƒœã‚¿ãƒ³ï¼ˆåŒ¿åOKãªã‚‰ãƒœã‚¿ãƒ³æ–‡è¨€ã ã‘åˆ‡æ›¿ï¼‰
    const signBtn = document.getElementById('signBtn');
    // ã‚ãªãŸã®æ—¢å­˜ã® auth ãƒ­ã‚¸ãƒƒã‚¯ã«ç½®ãæ›ãˆã¦ãã ã•ã„
    let signed = false;
    function setSignedIn(on) {
      signed = on;
      signBtn.textContent = on ? 'Sign out' : 'Sign in';
    }
    signBtn.addEventListener('click', ()=>{
      // æ—¢å­˜ã® signInAnonymously / signOut ã‚’å‘¼ã³å‡ºã™
      // æˆåŠŸæ™‚ã« setSignedIn(true/false) ã‚’å‘¼ã¶
      // ä¾‹: setSignedIn(!signed);
    });

    // 2) ã‚«ãƒ©ãƒ¼å…¥åŠ›ã®åŒæœŸï¼ˆmapå³ä¸‹ã® picker ã¨æŠ˜ã‚ŠãŸãŸã¿å†…ã® picker/hex ã‚’åŒæœŸï¼‰
    const p1 = document.getElementById('colorPicker');
    const p2 = document.getElementById('colorPicker2');
    const hex = document.getElementById('colorHex');
    function syncFromPicker(v){
      hex.value = v.toLowerCase();
      p1.value = v; p2.value = v;
    }
    [p1,p2].forEach(inp=>{
      inp.addEventListener('input', e=> syncFromPicker(e.target.value));
    });
    hex.addEventListener('input', e=>{
      const v = e.target.value.trim();
      if(/^(#)?[0-9a-fA-F]{6}$/.test(v)){
        syncFromPicker(v.startsWith('#')?v:'#'+v);
      }
    });

    // 3) ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ‡æ›¿ï¼ˆã‚ãªãŸã® setTile ã‚’å‘¼ã¶ï¼‰
    document.querySelectorAll('.seg-btn[data-tile]').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.seg-btn[data-tile]').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        const v = parseFloat(b.dataset.tile);
        document.getElementById('tileCustom').value = v;
        // æ—¢å­˜ã® setTile(v) ã‚’å‘¼ã¶
        // setTile(v);
      });
    });
    document.getElementById('tileApply').addEventListener('click', ()=>{
      const v = parseFloat(document.getElementById('tileCustom').value);
      if(!isFinite(v) || v <= 0){ alert('Invalid value'); return; }
      // setTile(v);
    });

    // 4) ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ“ä½œã¯æ—¢å­˜ã® showCooldown/lastPaintAt ã§
    // ã“ã“ã§ã¯ã‚¹ã‚¿ã‚¤ãƒ«/DOMã ã‘

    // 5) Leafletã®åˆæœŸåŒ–ã¯æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ä½¿ãˆã¾ã™
    // ä¾‹:
    // const map = L.map('map', { worldCopyJump: true }).setView([35.6762,139.6503], 6);
    // L.tileLayer(...).addTo(map);
    // window.map = map; // setMapHeight ã® invalidateSize ç”¨
  </script>
  <script src="script.js" defer></script>
</body>
</html>
