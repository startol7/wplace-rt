        // 東京にピクセルアートを描画
        function drawTokyoPixelArt() {
            // 大きな東京タワー（詳細版）
            const tokyoTowerLarge = [
                ['', '', '', '', '#ff0000', '', '', '', ''],
                ['', '', '', '#ff0000', '#ff0000', '#ff0000', '', '', ''],
                ['', '', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '', ''],
                ['', '#ff0000', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ff0000', ''],
                ['', '', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '', ''],
                ['', '', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000']
            ];
            drawPattern(35.6586, 139.7454, tokyoTowerLarge);
            
            // 詳細な富士山
            const mtFujiDetailed = [
                ['', '', '', '', '', '#ffffff', '', '', '', '', ''],
                ['', '', '', '', '#ffffff', '#ffffff', '#ffffff', '', '', '', ''],
                ['', '', '', '#ffffff', '#ffffff', '#87ceeb', '#ffffff', '#ffffff', '', '', ''],
                ['', '', '#ffffff', '#ffffff', '#87ceeb', '#87ceeb', '#87ceeb', '#ffffff', '#ffffff', '', ''],
                ['', '#4169e1', '#ffffff', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#ffffff', '#4169e1', ''],
                ['#4169e1', '#4169e1', '#4169e1', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#4169e1', '#4169e1', '#4169e1'],
                ['#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1'],
                ['#228b22', '#228b22', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#228b22', '#228b22'],
                ['#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22']
            ];
            drawPattern(35.6700, 139.7000, mtFujiDetailed);
            
            // 大きな桜の木
            const sakuraTree = [
                ['', '', '#ffb7c5', '#ffb7c5', '#ffb7c5', '#ffb7c5', '#ffb7c5', '', ''],
                ['', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', ''],
                ['#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5'],
                ['#ffb7c5', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ffb7c5'],
                ['', '#ffb7c5', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ffb7c5', ''],
                ['', '', '', '', '#8b4513', '', '', '', ''],
                ['', '', '', '', '#8b4513', '', '', '', ''],
                ['', '', '', '#8b4513', '#8b4513', '#8b4513', '', '', ''],
                ['', '', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '', ''],
                ['#228b22', '#228b22', '#228b22', '#8b4513', '#8b4513', '#8b4513', '#228b22', '#228b22', '#228b22']
            ];
            drawPattern(35.6800, 139.7600, sakuraTree);
            
            // 詳細なスカイツリー
            const skyTreeDetailed = [
                ['', '', '', '#87ceeb', '', '', ''],
                ['', '', '#87ceeb', '#87ceeb', '#87ceeb', '', ''],
                ['', '#87ceeb', '#ffffff', '#87ceeb', '#ffffff', '#87ceeb', ''],
                ['', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', ''],
                ['', '', '#708090', '#708090', '#708090', '', ''],
                ['', '', '#708090', '#708090', '#708090', '', ''],
                ['', '#708090', '#708090', '#708090', '#708090', '#708090', ''],
                ['', '#708090', '#ffffff', '#708090', '#ffffff', '#708090', ''],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090'],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090']
            ];
            drawPattern(35.7100, 139.8107, skyTreeDetailed);
            
            // 寿司セット
            const sushiSet = [
                ['#ff6347', '#ff6347', '#ff6347', '', '#ffa500', '#ffa500', '', '#ff69b4', '#ff69b4'],
                ['#ffffff', '#ffffff', '#ffffff', '', '#ffffff', '#ffffff', '', '#ffffff', '#ffffff'],
                ['', '', '', '', '', '', '', '', ''],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6500, 139.7300, sushiSet);
            
            // ラーメン丼（詳細）
            const ramenBowl = [
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#8b4513'],
                ['#8b4513', '#ffd700', '#ff6347', '#228b22', '#ffffff', '#ffa500', '#ffd700', '#8b4513'],
                ['#8b4513', '#ffd700', '#ffd700', '#ff69b4', '#ffd700', '#ffd700', '#ffd700', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6900, 139.7100, ramenBowl);
            
            // 大きな招き猫
            const manekinekoBig = [
                ['', '#ffffff', '', '', '', '#ffffff', ''],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#000000', '#ffffff', '#ffffff', '#ffffff', '#000000', '#ffffff'],
                ['#ffffff', '#ffffff', '#ffffff', '#ff69b4', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', ''],
                ['', '#ffffff', '', '#ffd700', '', '#ffffff', ''],
                ['', '#ffffff', '#ffd700', '#ffd700', '#ffd700', '#ffffff', '']
            ];
            drawPattern(35.6600, 139.7700, manekinekoBig);
            
            // 新幹線N700系（詳細）
            const shinkansenN700 = [
                ['', '', '', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', ''],
                ['', '', '#4169e1', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#4169e1'],
                ['', '#4169e1', '#ffffff', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#ffffff', '#ffffff'],
                ['#4169e1', '#ffffff', '#ffffff', '#000000', '#ffffff', '#000000', '#ffffff', '#ffffff', '#ffffff'],
                ['#708090', '#708090', '#000000', '#000000', '#000000', '#000000', '#000000', '#000000', '#000000']
            ];
            drawPattern(35.6850, 139.7400, shinkansenN700);
            
            // 大きな鳥居
            const toriiBig = [
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', '']
            ];
            drawPattern(35.6750, 139.7800, toriiBig);
            
            // 日本の城（詳細）
            const japaneseCastle = [
                ['', '', '', '', '#ffffff', '', '', '', ''],
                ['', '', '', '#ffffff', '#ffffff', '#ffffff', '', '', ''],
                ['', '', '#ffffff', '#708090', '#ffffff', '#708090', '#ffffff', '', ''],
                ['', '#ffffff', '#708090', '#ffffff', '#ffffff', '#ffffff', '#708090', '#ffffff', ''],
                ['#ffffff', '#708090', '#ffffff', '#000000', '#ffffff', '#000000', '#ffffff', '#708090', '#ffffff'],
                ['#708090', '#708090', '#708090', '#708090', '#000000', '#708090', '#708090', '#708090', '#708090'],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090'],
                ['#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969']
            ];
            drawPattern(35.6550, 139.7550, japaneseCastle);
            
            // 雷門
            const kaminarimon = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ff0000', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ffd700', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ff0000', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513']
            ];
            drawPattern(35.7120, 139.7950, kaminarimon);
            
            // 折り紙の鶴
            const origamiCrane = [
                ['', '', '#ff0000', '', '', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '', '', ''],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '', '#ff0000'],
                ['', '', '', '#ff0000', '', '', '']
            ];
            drawPattern(35.6650, 139.7650, origamiCrane);
            
            // 太鼓
            const taiko = [
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#8b4513'],
                ['#8b4513', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#8b4513'],
                ['#8b4513', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6700, 139.7200, taiko);
            
            // 相撲レスラー
            const sumoWrestler = [
                ['', '', '#000000', '#000000', '#000000', '', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['', '#fdbcb4', '#000000', '#fdbcb4', '#000000', '#fdbcb4', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['#fdbcb4', '#fdbcb4', '#4169e1', '#4169e1', '#4169e1', '#fdbcb4', '#fdbcb4'],
                ['#fdbcb4', '#fdbcb4', '#4169e1', '#4169e1', '#4169e1', '#fdbcb4', '#fdbcb4'],
                ['', '#fdbcb4', '#fdbcb4', '', '#fdbcb4', '#fdbcb4', ''],
                ['', '#fdbcb4', '#fdbcb4', '', '#fdbcb4', '#fdbcb4', '']
            ];
            drawPattern(35.6950, 139.7850, sumoWrestler);
            
            // だるま
            const daruma = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000'],
                ['#ff0000', '#000000', '#ff0000', '#000000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ffd700', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', '']
            ];
            drawPattern(35.6820, 139.7320, daruma);
            
            // 刀
            const katana = [
                ['', '', '', '', '', '', '#708090'],
                ['', '', '', '', '', '#708090', '#c0c0c0'],
                ['', '', '', '', '#708090', '#c0c0c0', ''],
                ['', '', '', '#708090', '#c0c0c0', '', ''],
                ['', '', '#708090', '#c0c0c0', '', '', ''],
                ['#8b4513', '#8b4513', '#c0c0c0', '', '', '', ''],
                ['#8b4513', '#8b4513', '', '', '', '', ''],
                ['#ffd700', '#8b4513', '', '', '', '', '']
            ];
            drawPattern(35.6880, 139.7680, katana);
            
            // 忍者
            const ninja = [
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['', '#000000', '#fdbcb4', '#000000', ''],
                ['#000000', '#000000', '#000000', '#000000', '#000000'],
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#000000', '', '#000000', ''],
                ['#000000', '#000000', '', '#000000', '#000000']
            ];
            drawPattern(35.6780, 139.7480, ninja);
            
            // 芸者
            const geisha = [
                ['', '#000000', '#000000', '#000000', ''],
                ['#000000', '#ff0000', '#000000', '#ff0000', '#000000'],
                ['', '#ffffff', '#ffffff', '#ffffff', ''],
                ['', '#ffffff', '#ff69b4', '#ffffff', ''],
                ['', '#ffffff', '#ff0000', '#ffffff', ''],
                ['#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4'],
                ['#ff69b4', '#ffd700', '#ff69b4', '#ffd700', '#ff69b4'],
                ['', '#ff69b4', '#ff69b4', '#ff69b4', '']
            ];
            drawPattern(35.6920, 139.7580, geisha);
            
            // 盆栽
            const bonsai = [
                ['', '', '#228b22', '#228b22', '#228b22', '', ''],
                ['', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', ''],
                ['#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22'],
                ['', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', ''],
                ['', '', '#8b4513', '#8b4513', '#8b4513', '', ''],
                ['', '', '', '#8b4513', '', '', ''],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6980, 139.7280, bonsai);
            
            // ここから新規追加分
            
            // おにぎり
            const onigiri = [
                ['', '', '#000000', '', ''],
                ['', '#ffffff', '#ffffff', '#ffffff', ''],
                ['#ffffff', '#ffffff', '#ff0000', '#ffffff', '#ffffff'],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['#000000', '#000000', '#000000', '#000000', '#000000']
            ];
            drawPattern(35.6400, 139.7100, onigiri);
            
            // 天ぷら
            const tempura = [
                ['', '#ffa500', '#ffa500', '#ffa500', ''],
                ['#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700'],
                ['#ffd700', '#ff6347', '#ffd700', '#ff6347', '#ffd700'],
                ['', '#ffd700', '#ffd700', '#ffd700', '']
            ];
            drawPattern(35.6450, 139.7150, tempura);
            
            // 抹茶
            const matcha = [
                ['', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#228b22', '#228b22', '#228b22', '#8b4513'],
                ['#8b4513', '#228b22', '#90ee90', '#228b22', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6350, 139.7250, matcha);
            
            // たこ焼き
            const takoyaki = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#ffa500', '#ffa500', '#8b4513'],
                ['#8b4513', '#228b22', '#ff0000', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6380, 139.7350, takoyaki);
            
            // 日本酒
            const sake = [
                ['', '', '#ffffff', '', ''],
                ['', '#4169e1', '#4169e1', '#4169e1', ''],
                ['#ffffff', '#4169e1', '#4169e1', '#4169e1', '#ffffff'],
                ['#ffffff', '#4169e1', '#4169e1', '#4169e1', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '']
            ];
            drawPattern(35.6420, 139.7400, sake);
            
            // 団子
            const dango = [
                ['', '#ff69b4', '', '#ffffff', '', '#90ee90', ''],
                ['', '#ff69b4', '', '#ffffff', '', '#90ee90', ''],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6480, 139.7450, dango);
            
            // カメラ（観光客）
            const camera = [
                ['#000000', '#000000', '#000000', '#000000', '#000000'],
                ['#000000', '#ffffff', '#000000', '#ffffff', '#000000'],
                ['#000000', '#4169e1', '#4169e1', '#4169e1', '#000000'],
                ['#000000', '#000000', '#000000', '#000000', '#000000']
            ];
            drawPattern(35.6520, 139.7500, camera);
            
            // 風鈴
            const windChime = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['', '', '#708090', '', ''],
                ['', '', '#708090', '', ''],
                ['', '#87ceeb', '#87ceeb', '#87ceeb', ''],
                ['#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb']
            ];
            drawPattern(35.6560, 139.7350, windChime);
            
            // こけし
            const kokeshi = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#ff0000'],
                ['', '#000000', '#fdbcb4', '#000000', ''],
                ['', '#fdbcb4', '#ff69b4', '#fdbcb4', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffd700', '#ff0000', '#ffd700', '#ff0000']
            ];
            drawPattern(35.6620, 139.7200, kokeshi);
            
            // 扇子
            const sensu = [
                ['#ff0000', '', '', '', '#ff0000'],
                ['#ff0000', '#ffd700', '', '#ffd700', '#ff0000'],
                ['#ff0000', '#ffd700', '#ffffff', '#ffd700', '#ff0000'],
                ['#ff0000', '#ffd700', '#ffffff', '#ffd700', '#ff0000'],
                ['#ff0000', '#ffd700', '#ffffff', '#ffd700', '#ff0000'],
                ['', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6680, 139.7250, sensu);
            
            // 提灯
            const chochin = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000'],
                ['#ff0000', '#ff0000', '#ffd700', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['', '', '#000000', '', '']
            ];
            drawPattern(35.6720, 139.7150, chochin);
            
            // 竹
            const bamboo = [
                ['', '#228b22', ''],
                ['', '#228b22', ''],
                ['#90ee90', '#228b22', '#90ee90'],
                ['', '#228b22', ''],
                ['', '#228b22', ''],
                ['#90ee90', '#228b22', '#90ee90'],
                ['', '#228b22', ''],
                ['', '#228b22', '']
            ];
            drawPattern(35.6760, 139.7380, bamboo);
            
            // 鯉のぼり
            const koinobori = [
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ff0000'],
                ['#ff0000', '#000000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '', '', '', ''],
                ['#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1'],
                ['#4169e1', '#ffffff', '#4169e1', '#ffffff', '#4169e1', '#4169e1'],
                ['#4169e1', '#000000', '#4169e1', '#4169e1', '#4169e1', '#4169e1']
            ];
            drawPattern(35.6810, 139.7430, koinobori);
            
            // 着物
            const kimono = [
                ['', '#ff69b4', '#ff69b4', '#ff69b4', ''],
                ['#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4'],
                ['#ff69b4', '#ffd700', '#ff69b4', '#ffd700', '#ff69b4'],
                ['#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4'],
                ['#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4'],
                ['', '#ff69b4', '', '#ff69b4', '']
            ];
            drawPattern(35.6860, 139.7530, kimono);
            
            // 将棋の駒
            const shogi = [
                ['', '#ffd700', '#ffd700', '#ffd700', ''],
                ['#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700'],
                ['#ffd700', '#000000', '#000000', '#000000', '#ffd700'],
                ['#ffd700', '#000000', '#000000', '#000000', '#ffd700'],
                ['#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700']
            ];
            drawPattern(35.6910, 139.7630, shogi);
            
            // 凧
            const tako = [
                ['', '', '#ff0000', '', ''],
                ['', '#ff0000', '#ffd700', '#ff0000', ''],
                ['#ff0000', '#ffd700', '#ff0000', '#ffd700', '#ff0000'],
                ['', '#ff0000', '#ffd700', '#ff0000', ''],
                ['', '', '#ff0000', '', ''],
                ['', '', '#000000', '', ''],
                ['', '', '#000000', '', '']
            ];
            drawPattern(35.6960, 139.7730, tako);
            
            // お面（狐）
            const kitsuneMask = [
                ['#ff0000', '', '', '', '#ff0000'],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#000000', '#ffffff', '#000000', '#ffffff'],
                ['#ffffff', '#ffffff', '#ff0000', '#ffffff', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '']
            ];
            drawPattern(35.7010, 139.7180, kitsuneMask);
            
            // 神輿
            const mikoshi = [
                ['', '#ffd700', '#ffd700', '#ffd700', ''],
                ['#ffd700', '#ffd700', '#ff0000', '#ffd700', '#ffd700'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#ffd700', '#8b4513', '#ffd700', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.7050, 139.7830, mikoshi);
            
            // 和傘
            const wagasa = [
                ['', '', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '#8b4513', '', ''],
                ['', '', '#8b4513', '', ''],
                ['', '', '#8b4513', '', '']
            ];
            drawPattern(35.6470, 139.7550, wagasa);
            
            // 餅
            const mochi = [
                ['', '#ffffff', '#ffffff', '#ffffff', ''],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '']
            ];
            drawPattern(35.6510, 139.7600, mochi);
            
            // わさび
            const wasabi = [
                ['', '#90ee90', ''],
                ['#228b22', '#90ee90', '#228b22'],
                ['#228b22', '#228b22', '#228b22']
            ];
            drawPattern(35.6550, 139.7650, wasabi);
            
            // 歌舞伎マスク
            const kabukiMask = [
                ['', '#ffffff', '#ffffff', '#ffffff', ''],
                ['#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ffffff'],
                ['#ffffff', '#000000', '#ffffff', '#000000', '#ffffff'],
                ['#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '']
            ];
            drawPattern(35.6590, 139.7700, kabukiMask);
            
            // 納豆
            const natto = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#ffd700', '#ffd700', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6630, 139.7750, natto);
            
            // 豆腐
            const tofu = [
                ['#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#f0f0f0', '#ffffff'],
                ['#ffffff', '#ffffff', '#ffffff']
            ];
            drawPattern(35.6670, 139.7800, tofu);
            
            // 弁当箱
            const bento = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#ff0000', '#ffd700', '#90ee90', '#8b4513'],
                ['#8b4513', '#ffffff', '#ff6347', '#ffa500', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6710, 139.7850, bento);
            
            // 梅干し
            const umeboshi = [
                ['', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff69b4', '#ff69b4', '#ff0000'],
                ['#ff0000', '#ff69b4', '#ff69b4', '#ff0000'],
                ['', '#ff0000', '#ff0000', '']
            ];
            drawPattern(35.6750, 139.7900, umeboshi);
            
            // 枯山水
            const karesansui = [
                ['#d3d3d3', '#d3d3d3', '#d3d3d3', '#d3d3d3', '#d3d3d3'],
                ['#d3d3d3', '#808080', '#d3d3d3', '#808080', '#d3d3d3'],
                ['#d3d3d3', '#d3d3d3', '#696969', '#d3d3d3', '#d3d3d3'],
                ['#d3d3d3', '#808080', '#d3d3d3', '#808080', '#d3d3d3'],
                ['#d3d3d3', '#d3d3d3', '#d3d3d3', '#d3d3d3', '#d3d3d3']
            ];
            drawPattern(35.6790, 139.7950, karesansui);
            
            // 茶道の茶碗
            const chawan = [
                ['', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#228b22', '#90ee90', '#228b22', '#8b4513'],
                ['#8b4513', '#228b22', '#228b22', '#228b22', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6830, 139.8000, chawan);
            
            // 手裏剣
            const shuriken = [
                ['', '#708090', '', '#708090', ''],
                ['#708090', '#708090', '#c0c0c0', '#708090', '#708090'],
                ['', '#c0c0c0', '#c0c0c0', '#c0c0c0', ''],
                ['#708090', '#708090', '#c0c0c0', '#708090', '#708090'],
                ['', '#708090', '', '#708090', '']
            ];
            drawPattern(35.6870, 139.7080, shuriken);
            
            // 侍の兜
            const kabuto = [
                ['#708090', '', '#708090', '', '#708090'],
                ['', '#708090', '#708090', '#708090', ''],
                ['#708090', '#ffd700', '#708090', '#ffd700', '#708090'],
                ['#708090', '#708090', '#708090', '#708090', '#708090']
            ];
            drawPattern(35.6910, 139.7130, kabuto);
            
            // 錦鯉
            const koi = [
                ['', '', '#ff6347', '', ''],
                ['', '#ff6347', '#ffffff', '#ff6347', ''],
                ['#ff6347', '#ffffff', '#000000', '#ffffff', '#ff6347'],
                ['', '#ff6347', '#ffffff', '#ff6347', ''],
                ['', '', '#ff6347', '#ff6347', '']
            ];
            drawPattern(35.6950, 139.7180, koi);
            
            // お守り
            const omamori = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffd700', '#ffd700', '#ffd700', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', '']
            ];
            drawPattern(35.6990, 139.7230, omamori);
            
            // うどん
            const udon = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#ffffff', '#ffffff', '#ffffff', '#8b4513'],
                ['#8b4513', '#90ee90', '#ff69b4', '#ffd700', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.7030, 139.7280, udon);
            
            // カレーライス
            const curry = [
                ['#ffffff', '#ffffff', '#ffffff', '#8b4513', '#8b4513'],
                ['#ffffff', '#ffffff', '#ffffff', '#8b4513', '#8b4513'],
                ['#ffffff', '#ffffff', '#ffffff', '#8b4513', '#8b4513']
            ];
            drawPattern(35.7070, 139.7330, curry);
            
            // お好み焼き
            const okonomiyaki = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#90ee90', '#ff69b4', '#8b4513'],
                ['#8b4513', '#ffd700', '#ffffff', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.7110, 139.7380, okonomiyaki);
            
            // 羽子板
            const hagoita = [
                ['', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#ff0000', '#ffd700', '#ff0000', '#8b4513'],
                ['#8b4513', '#ffd700', '#ff0000', '#ffd700', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', ''],
                ['', '', '#8b4513', '', ''],
                ['', '', '#8b4513', '', '']
            ];
            drawPattern(35.6480, 139.8050, hagoita);
            
            // 囲碁
            const igo = [
                ['#ffd700', '#000000', '#ffd700', '#000000'],
                ['#000000', '#ffffff', '#000000', '#ffd700'],
                ['#ffd700', '#000000', '#ffffff', '#000000'],
                ['#000000', '#ffd700', '#000000', '#ffffff']
            ];
            drawPattern(35.6520, 139.8100, igo);
            
            // 太陽（日の丸）
            const hinomaru = [
                ['', '', '#ff0000', '#ff0000', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '', '']
            ];
            drawPattern(35.6560, 139.8150, hinomaru);
            
            // 浴衣
            const yukata = [
                ['', '#4169e1', '#4169e1', '#4169e1', ''],
                ['#4169e1', '#ffffff', '#4169e1', '#ffffff', '#4169e1'],
                ['#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1'],
                ['#4169e1', '#ffffff', '#4169e1', '#ffffff', '#4169e1'],
                ['#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1']
            ];
            drawPattern(35.6600, 139.8200, yukata);
            
            // 和太鼓の撥
            const bachi = [
                ['#8b4513', '', '', '', '#8b4513'],
                ['', '#8b4513', '', '#8b4513', ''],
                ['', '', '#8b4513', '', ''],
                ['', '#8b4513', '', '#8b4513', ''],
                ['#8b4513', '', '', '', '#8b4513']
            ];
            drawPattern(35.6640, 139.7050, bachi);
            
            // 羽織
            const haori = [
                ['#000000', '#000000', '#000000', '#000000', '#000000'],
                ['#000000', '#ffd700', '#000000', '#ffd700', '#000000'],
                ['#000000', '#000000', '#000000', '#000000', '#000000'],
                ['#000000', '#ffd700', '#000000', '#ffd700', '#000000'],
                ['#000000', '#000000', '#000000', '#000000', '#000000']
            ];
            drawPattern(35.6680, 139.7100, haori);
            
            // 般若面
            const hannyaMask = [
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#000000', '#ff0000', '#000000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ffffff', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffffff', '#ffffff', '#ffffff', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', '']
            ];
            drawPattern(35.6720, 139.8250, hannyaMask);
            
            // 緑茶
            const greenTea = [
                ['', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#90ee90', '#90ee90', '#90ee90', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6760, 139.8300, greenTea);
            
            totalTileCount = 1000; // 初期タイル数
            document.getElementById('statTotal').textContent = totalTileCount;<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TePlace - World Map Game</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4F90EG7W7N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4F90EG7W7N');
    </script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        /* 観光地ポップアップ */
        .location-popup {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 0;
            width: 280px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .location-popup .photo-container {
            width: 100%;
            height: 180px;
            overflow: hidden;
            position: relative;
        }
        
        .location-popup img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .location-popup .photo-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        
        .location-popup .info {
            padding: 12px;
            color: #333;
        }
        
        .location-popup h3 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: bold;
            color: #1a1a2e;
        }
        
        .location-popup .description {
            font-size: 13px;
            line-height: 1.4;
            color: #666;
            margin-bottom: 8px;
        }
        
        .location-popup .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .location-popup .tag {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* マーカーアイコン */
        .location-marker {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .location-marker:hover {
            transform: scale(1.2);
        }
        
        /* 写真アップロードパネル */
        .photo-upload-panel {
            position: fixed;
            top: 70px;
            right: 10px;
            background: rgba(15, 52, 96, 0.95);
            border-radius: 10px;
            padding: 15px;
            width: 250px;
            z-index: 1000;
            display: none;
        }
        
        .photo-upload-panel.active {
            display: block;
        }
        
        .photo-upload-panel h4 {
            margin: 0 0 10px 0;
            color: #ffd700;
            font-size: 16px;
        }
        
        .photo-upload-panel input[type="file"] {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .photo-upload-panel button {
            width: 100%;
            padding: 8px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .photo-upload-panel button:hover {
            background: #764ba2;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            height: 60px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        select {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
            cursor: pointer;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }
        
        #map {
            flex: 1;
            height: 100%;
            background: #f0f0f0;
        }
        
        .sidebar {
            width: 320px;
            background: #0f3460;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .panel h3 {
            margin-bottom: 10px;
            font-size: 18px;
            color: #ffd700;
        }
        
        .color-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        
        .color-picker {
            width: 50px;
            height: 50px;
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .color-hex {
            flex: 1;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-family: monospace;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .tab {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
        }
        
        .ranking-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .ranking-list li {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .ranking-list strong {
            color: #ffd700;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4caf50;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            margin-top: 5px;
        }
        
        .cooldown {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            text-align: center;
        }
        
        .cooldown-bar {
            width: 100%;
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .cooldown-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.1s linear;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            #map {
                height: 60vh;
            }
            
            .sidebar {
                width: 100%;
                height: 40vh;
                padding: 10px;
            }
            
            .header {
                padding: 10px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .controls {
                gap: 10px;
            }
            
            select {
                padding: 5px 10px;
                font-size: 12px;
            }
        }
        
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                top: 60px;
                opacity: 0;
            }
            to {
                top: 80px;
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            🌍 TePlace
        </div>
        <div class="controls">
            <select id="countrySelect">
                <option value="Japan">Japan</option>
                <option value="United States">United States</option>
                <option value="Korea">Korea</option>
                <option value="China">China</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="France">France</option>
                <option value="Germany">Germany</option>
                <option value="Brazil">Brazil</option>
            </select>
        </div>
    </div>
    
    <div class="container">
        <div id="map"></div>
        
        <div class="sidebar">
            <div class="panel">
                <h3>📊 Statistics</h3>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">Total</div>
                    <div class="panel">
                <h3>📍 Add Location Photo</h3>
                <button id="togglePhotoMode" style="width: 100%; padding: 8px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Toggle Photo Mode
                </button>
                <div id="photoStatus" style="margin-top: 10px; font-size: 12px; color: #ffd700;">
                    Click on map to add photos
                </div>
            </div>
                    <div class="stat">
                        <div class="stat-value" id="statMine">0</div>
                        <div class="stat-label">Yours</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="statOnline">0</div>
                        <div class="stat-label">Online</div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h3>🎨 Color</h3>
                <div class="color-controls">
                    <input type="color" class="color-picker" id="colorPicker" value="#ff4444">
                    <input type="text" class="color-hex" id="colorHex" value="#ff4444">
                </div>
            </div>
            
            <div class="panel">
                <h3>🏆 World Ranking</h3>
                <div class="tabs">
                    <button class="tab active" data-period="today">Today</button>
                    <button class="tab" data-period="week">Week</button>
                    <button class="tab" data-period="month">Month</button>
                </div>
                <ul class="ranking-list" id="rankingList">
                    <li>Loading...</li>
                </ul>
            </div>
            
            <div class="panel">
                <h3>⏱️ Cooldown</h3>
                <div class="cooldown">
                    <div id="cooldownText">Ready!</div>
                    <div class="cooldown-bar">
                        <div class="cooldown-fill" id="cooldownFill"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // グローバル変数
        let map = null;
        let tilesLayer = null;
        let locationsLayer = null;
        let currentCountry = 'Japan';
        let currentColor = '#ff4444';
        let cooldownEnd = 0;
        let myTileCount = 0;
        let totalTileCount = 0;
        let photoMode = false;
        let userPhotos = {};
        
        // 東京の観光地データ
        const touristLocations = [
            {
                id: 'shibuya-scramble',
                name: '渋谷スクランブルスクエア',
                lat: 35.6595,
                lng: 139.7004,
                description: '渋谷の新しいランドマーク。屋上展望台「SHIBUYA SKY」からの眺めは絶景！',
                tags: ['展望台', '夜景', 'ショッピング'],
                emoji: '🏢',
                defaultPhoto: 'https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=400&h=300&fit=crop'
            },
            {
                id: 'sensoji',
                name: '浅草寺',
                lat: 35.7148,
                lng: 139.7967,
                description: '東京最古の寺院。雷門と仲見世通りが有名な観光スポット。',
                tags: ['寺院', '歴史', '仲見世'],
                emoji: '⛩️',
                defaultPhoto: 'https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&h=300&fit=crop'
            },
            {
                id: 'tokyo-tower',
                name: '東京タワー',
                lat: 35.6586,
                lng: 139.7454,
                description: '高さ333mの電波塔。東京のシンボル的存在。',
                tags: ['展望台', 'ライトアップ', 'シンボル'],
                emoji: '🗼',
                defaultPhoto: 'https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?w=400&h=300&fit=crop'
            },
            {
                id: 'skytree',
                name: '東京スカイツリー',
                lat: 35.7100,
                lng: 139.8107,
                description: '高さ634mの世界一高い電波塔。展望デッキからの眺望は圧巻。',
                tags: ['展望台', 'ショッピング', 'プラネタリウム'],
                emoji: '🗼',
                defaultPhoto: 'https://images.unsplash.com/photo-1508038118390-0ca2971a3e2f?w=400&h=300&fit=crop'
            },
            {
                id: 'meiji-shrine',
                name: '明治神宮',
                lat: 35.6764,
                lng: 139.6993,
                description: '都心の緑豊かな神社。初詣の参拝者数日本一。',
                tags: ['神社', '森', 'パワースポット'],
                emoji: '⛩️',
                defaultPhoto: 'https://images.unsplash.com/photo-1590559899731-a382839e5549?w=400&h=300&fit=crop'
            },
            {
                id: 'tsukiji',
                name: '築地場外市場',
                lat: 35.6654,
                lng: 139.7707,
                description: '新鮮な海鮮と食べ歩きグルメが楽しめる市場。',
                tags: ['グルメ', '海鮮', '朝市'],
                emoji: '🍣',
                defaultPhoto: 'https://images.unsplash.com/photo-1553621042-f6381c8f3139?w=400&h=300&fit=crop'
            },
            {
                id: 'harajuku',
                name: '原宿・竹下通り',
                lat: 35.6702,
                lng: 139.7026,
                description: '若者文化の発信地。カワイイ文化とファッションの聖地。',
                tags: ['ファッション', 'カフェ', 'ショッピング'],
                emoji: '🛍️',
                defaultPhoto: 'https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=400&h=300&fit=crop'
            },
            {
                id: 'ginza',
                name: '銀座',
                lat: 35.6717,
                lng: 139.7642,
                description: '高級ブランド店が立ち並ぶショッピング街。',
                tags: ['ショッピング', '高級', 'グルメ'],
                emoji: '💎',
                defaultPhoto: 'https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?w=400&h=300&fit=crop'
            },
            {
                id: 'akihabara',
                name: '秋葉原',
                lat: 35.6984,
                lng: 139.7731,
                description: '電気街とオタク文化の中心地。アニメ・ゲーム・電子機器の聖地。',
                tags: ['電気街', 'アニメ', 'ゲーム'],
                emoji: '🎮',
                defaultPhoto: 'https://images.unsplash.com/photo-1526481280693-3bfa7568e0f3?w=400&h=300&fit=crop'
            },
            {
                id: 'roppongi-hills',
                name: '六本木ヒルズ',
                lat: 35.6604,
                lng: 139.7292,
                description: '展望台、美術館、ショッピングが楽しめる複合施設。',
                tags: ['展望台', '美術館', 'ナイトライフ'],
                emoji: '🌃',
                defaultPhoto: 'https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?w=400&h=300&fit=crop'
            },
            {
                id: 'odaiba',
                name: 'お台場',
                lat: 35.6298,
                lng: 139.7753,
                description: 'レインボーブリッジとフジテレビが有名な観光エリア。',
                tags: ['ビーチ', 'ショッピング', '夜景'],
                emoji: '🌉',
                defaultPhoto: 'https://images.unsplash.com/photo-1498036882173-b41c28a8ba34?w=400&h=300&fit=crop'
            },
            {
                id: 'ueno',
                name: '上野公園',
                lat: 35.7146,
                lng: 139.7746,
                description: '動物園、美術館、博物館が集まる文化の森。春は桜の名所。',
                tags: ['公園', '美術館', '動物園'],
                emoji: '🌸',
                defaultPhoto: 'https://images.unsplash.com/photo-1522383225653-ed111181a951?w=400&h=300&fit=crop'
            },
            {
                id: 'shinjuku-gyoen',
                name: '新宿御苑',
                lat: 35.6852,
                lng: 139.7100,
                description: '都心のオアシス。日本庭園、フランス庭園、イギリス庭園が楽しめる。',
                tags: ['公園', '庭園', '桜'],
                emoji: '🌳',
                defaultPhoto: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=400&h=300&fit=crop'
            },
            {
                id: 'kichijoji',
                name: '吉祥寺・井の頭公園',
                lat: 35.7024,
                lng: 139.5799,
                description: '住みたい街ランキング常連。井の頭公園とハモニカ横丁が人気。',
                tags: ['公園', 'カフェ', 'ショッピング'],
                emoji: '🦆',
                defaultPhoto: 'https://images.unsplash.com/photo-1568639484858-01a704bc054f?w=400&h=300&fit=crop'
            },
            {
                id: 'imperial-palace',
                name: '皇居',
                lat: 35.6852,
                lng: 139.7528,
                description: '皇室の居住地。東御苑は一般公開されている美しい庭園。',
                tags: ['歴史', '庭園', 'ランニング'],
                emoji: '🏯',
                defaultPhoto: 'https://images.unsplash.com/photo-1560799240-8353a61b0b47?w=400&h=300&fit=crop'
            }
        ];
        
        // タイルサイズ
        const TILE_SIZE = 0.0003;
        
        // 地図の初期化
        function initMap() {
            try {
                console.log('Initializing map...');
                
                // 地図を作成 - 東京にフォーカス
                map = L.map('map', {
                    center: [35.6762, 139.6503],
                    zoom: 12,
                    zoomControl: true
                });
                
                // OpenStreetMapタイルレイヤーを追加
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
                
                // タイル描画用レイヤー
                tilesLayer = L.layerGroup().addTo(map);
                
                // クリックイベントを設定
                map.on('click', onMapClick);
                
                // 観光地マーカーを追加
                addTouristLocations();
                
                console.log('Map initialized successfully');
                
                // 東京にピクセルアートを描画
                setTimeout(() => {
                    drawTokyoPixelArt();
                }, 1000);
                
            } catch (error) {
                console.error('Error initializing map:', error);
            }
        }
        
        // 観光地マーカーを追加
        function addTouristLocations() {
            locationsLayer = L.layerGroup().addTo(map);
            
            touristLocations.forEach(location => {
                // カスタムアイコンを作成
                const icon = L.divIcon({
                    html: `<div class="location-marker">${location.emoji}</div>`,
                    className: 'custom-div-icon',
                    iconSize: [36, 36],
                    iconAnchor: [18, 18]
                });
                
                // マーカーを作成
                const marker = L.marker([location.lat, location.lng], { icon })
                    .addTo(locationsLayer);
                
                // ポップアップコンテンツを作成
                const popupContent = createLocationPopup(location);
                
                // ホバーでポップアップ表示
                marker.bindPopup(popupContent, {
                    maxWidth: 280,
                    className: 'location-popup',
                    closeButton: false,
                    autoClose: false
                });
                
                // ホバーイベント
                marker.on('mouseover', function() {
                    this.openPopup();
                });
                
                marker.on('mouseout', function() {
                    setTimeout(() => {
                        this.closePopup();
                    }, 500);
                });
                
                // クリックでも表示
                marker.on('click', function(e) {
                    if (photoMode) {
                        // 写真モードの場合は写真をアップロード
                        uploadPhotoForLocation(location.id, e);
                    } else {
                        this.openPopup();
                    }
                });
            });
        }
        
        // ロケーションポップアップを作成
        function createLocationPopup(location) {
            const userPhoto = userPhotos[location.id];
            const photoUrl = userPhoto || location.defaultPhoto;
            
            const html = `
                <div class="photo-container">
                    ${photoUrl ? 
                        `<img src="${photoUrl}" alt="${location.name}" onerror="this.parentElement.innerHTML='<div class=\\'photo-placeholder\\'>${location.emoji}</div>'">` :
                        `<div class="photo-placeholder">${location.emoji}</div>`
                    }
                </div>
                <div class="info">
                    <h3>${location.name}</h3>
                    <p class="description">${location.description}</p>
                    <div class="tags">
                        ${location.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // 写真をアップロード
        function uploadPhotoForLocation(locationId, event) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        userPhotos[locationId] = e.target.result;
                        localStorage.setItem('userPhotos', JSON.stringify(userPhotos));
                        
                        // マーカーを更新
                        locationsLayer.clearLayers();
                        addTouristLocations();
                        
                        showToast('Photo uploaded successfully!');
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            input.click();
        }
        
        // タイル描画
        function drawTile(lat, lng, color, opacity = 0.7) {
            const lat0 = Math.floor(lat / TILE_SIZE) * TILE_SIZE;
            const lng0 = Math.floor(lng / TILE_SIZE) * TILE_SIZE;
            
            const bounds = [
                [lat0, lng0],
                [lat0 + TILE_SIZE, lng0 + TILE_SIZE]
            ];
            
            const rect = L.rectangle(bounds, {
                color: color,
                fillColor: color,
                fillOpacity: opacity,
                weight: 0.5
            });
            
            rect.addTo(tilesLayer);
            return rect;
        }
        
        // 東京にピクセルアートを描画
        function drawTokyoPixelArt() {
            // 大きな東京タワー（詳細版）
            const tokyoTowerLarge = [
                ['', '', '', '', '#ff0000', '', '', '', ''],
                ['', '', '', '#ff0000', '#ff0000', '#ff0000', '', '', ''],
                ['', '', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '', ''],
                ['', '#ff0000', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ff0000', ''],
                ['', '', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '', ''],
                ['', '', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000']
            ];
            drawPattern(35.6586, 139.7454, tokyoTowerLarge);
            
            // 詳細な富士山
            const mtFujiDetailed = [
                ['', '', '', '', '', '#ffffff', '', '', '', '', ''],
                ['', '', '', '', '#ffffff', '#ffffff', '#ffffff', '', '', '', ''],
                ['', '', '', '#ffffff', '#ffffff', '#87ceeb', '#ffffff', '#ffffff', '', '', ''],
                ['', '', '#ffffff', '#ffffff', '#87ceeb', '#87ceeb', '#87ceeb', '#ffffff', '#ffffff', '', ''],
                ['', '#4169e1', '#ffffff', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#ffffff', '#4169e1', ''],
                ['#4169e1', '#4169e1', '#4169e1', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#4169e1', '#4169e1', '#4169e1'],
                ['#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1'],
                ['#228b22', '#228b22', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#228b22', '#228b22'],
                ['#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22']
            ];
            drawPattern(35.6700, 139.7000, mtFujiDetailed);
            
            // 大きな桜の木
            const sakuraTree = [
                ['', '', '#ffb7c5', '#ffb7c5', '#ffb7c5', '#ffb7c5', '#ffb7c5', '', ''],
                ['', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', ''],
                ['#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5'],
                ['#ffb7c5', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ffb7c5'],
                ['', '#ffb7c5', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ff69b4', '#ffb7c5', '#ffb7c5', ''],
                ['', '', '', '', '#8b4513', '', '', '', ''],
                ['', '', '', '', '#8b4513', '', '', '', ''],
                ['', '', '', '#8b4513', '#8b4513', '#8b4513', '', '', ''],
                ['', '', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '', ''],
                ['#228b22', '#228b22', '#228b22', '#8b4513', '#8b4513', '#8b4513', '#228b22', '#228b22', '#228b22']
            ];
            drawPattern(35.6800, 139.7600, sakuraTree);
            
            // 詳細なスカイツリー
            const skyTreeDetailed = [
                ['', '', '', '#87ceeb', '', '', ''],
                ['', '', '#87ceeb', '#87ceeb', '#87ceeb', '', ''],
                ['', '#87ceeb', '#ffffff', '#87ceeb', '#ffffff', '#87ceeb', ''],
                ['', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', '#87ceeb', ''],
                ['', '', '#708090', '#708090', '#708090', '', ''],
                ['', '', '#708090', '#708090', '#708090', '', ''],
                ['', '#708090', '#708090', '#708090', '#708090', '#708090', ''],
                ['', '#708090', '#ffffff', '#708090', '#ffffff', '#708090', ''],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090'],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090']
            ];
            drawPattern(35.7100, 139.8107, skyTreeDetailed);
            
            // 寿司セット
            const sushiSet = [
                ['#ff6347', '#ff6347', '#ff6347', '', '#ffa500', '#ffa500', '', '#ff69b4', '#ff69b4'],
                ['#ffffff', '#ffffff', '#ffffff', '', '#ffffff', '#ffffff', '', '#ffffff', '#ffffff'],
                ['', '', '', '', '', '', '', '', ''],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6500, 139.7300, sushiSet);
            
            // ラーメン丼（詳細）
            const ramenBowl = [
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#ffd700', '#8b4513'],
                ['#8b4513', '#ffd700', '#ff6347', '#228b22', '#ffffff', '#ffa500', '#ffd700', '#8b4513'],
                ['#8b4513', '#ffd700', '#ffd700', '#ff69b4', '#ffd700', '#ffd700', '#ffd700', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6900, 139.7100, ramenBowl);
            
            // 大きな招き猫
            const manekinekoBig = [
                ['', '#ffffff', '', '', '', '#ffffff', ''],
                ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#000000', '#ffffff', '#ffffff', '#ffffff', '#000000', '#ffffff'],
                ['#ffffff', '#ffffff', '#ffffff', '#ff69b4', '#ffffff', '#ffffff', '#ffffff'],
                ['#ffffff', '#ffffff', '#ff0000', '#ff0000', '#ff0000', '#ffffff', '#ffffff'],
                ['', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', ''],
                ['', '#ffffff', '', '#ffd700', '', '#ffffff', ''],
                ['', '#ffffff', '#ffd700', '#ffd700', '#ffd700', '#ffffff', '']
            ];
            drawPattern(35.6600, 139.7700, manekinekoBig);
            
            // 新幹線N700系（詳細）
            const shinkansenN700 = [
                ['', '', '', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#4169e1', ''],
                ['', '', '#4169e1', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff', '#4169e1'],
                ['', '#4169e1', '#ffffff', '#4169e1', '#4169e1', '#4169e1', '#4169e1', '#ffffff', '#ffffff'],
                ['#4169e1', '#ffffff', '#ffffff', '#000000', '#ffffff', '#000000', '#ffffff', '#ffffff', '#ffffff'],
                ['#708090', '#708090', '#000000', '#000000', '#000000', '#000000', '#000000', '#000000', '#000000']
            ];
            drawPattern(35.6850, 139.7400, shinkansenN700);
            
            // 大きな鳥居
            const toriiBig = [
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', ''],
                ['', '', '#ff0000', '', '', '', '#ff0000', '', '']
            ];
            drawPattern(35.6750, 139.7800, toriiBig);
            
            // 日本の城（詳細）
            const japaneseCastle = [
                ['', '', '', '', '#ffffff', '', '', '', ''],
                ['', '', '', '#ffffff', '#ffffff', '#ffffff', '', '', ''],
                ['', '', '#ffffff', '#708090', '#ffffff', '#708090', '#ffffff', '', ''],
                ['', '#ffffff', '#708090', '#ffffff', '#ffffff', '#ffffff', '#708090', '#ffffff', ''],
                ['#ffffff', '#708090', '#ffffff', '#000000', '#ffffff', '#000000', '#ffffff', '#708090', '#ffffff'],
                ['#708090', '#708090', '#708090', '#708090', '#000000', '#708090', '#708090', '#708090', '#708090'],
                ['#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090', '#708090'],
                ['#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969', '#696969']
            ];
            drawPattern(35.6550, 139.7550, japaneseCastle);
            
            // 雷門
            const kaminarimon = [
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ff0000', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ffd700', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '#ff0000', '#ff0000', '#ff0000', '', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513'],
                ['#8b4513', '', '', '', '', '', '#8b4513']
            ];
            drawPattern(35.7120, 139.7950, kaminarimon);
            
            // 折り紙の鶴
            const origamiCrane = [
                ['', '', '#ff0000', '', '', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '', '', ''],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '', ''],
                ['', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', ''],
                ['', '', '#ff0000', '#ff0000', '#ff0000', '', '#ff0000'],
                ['', '', '', '#ff0000', '', '', '']
            ];
            drawPattern(35.6650, 139.7650, origamiCrane);
            
            // 太鼓
            const taiko = [
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', ''],
                ['#8b4513', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#8b4513'],
                ['#8b4513', '#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000', '#8b4513'],
                ['#8b4513', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000', '#8b4513'],
                ['', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '']
            ];
            drawPattern(35.6700, 139.7200, taiko);
            
            // 相撲レスラー
            const sumoWrestler = [
                ['', '', '#000000', '#000000', '#000000', '', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['', '#fdbcb4', '#000000', '#fdbcb4', '#000000', '#fdbcb4', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['#fdbcb4', '#fdbcb4', '#4169e1', '#4169e1', '#4169e1', '#fdbcb4', '#fdbcb4'],
                ['#fdbcb4', '#fdbcb4', '#4169e1', '#4169e1', '#4169e1', '#fdbcb4', '#fdbcb4'],
                ['', '#fdbcb4', '#fdbcb4', '', '#fdbcb4', '#fdbcb4', ''],
                ['', '#fdbcb4', '#fdbcb4', '', '#fdbcb4', '#fdbcb4', '']
            ];
            drawPattern(35.6950, 139.7850, sumoWrestler);
            
            // だるま
            const daruma = [
                ['', '#ff0000', '#ff0000', '#ff0000', ''],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['#ff0000', '#ffffff', '#ff0000', '#ffffff', '#ff0000'],
                ['#ff0000', '#000000', '#ff0000', '#000000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ffd700', '#ff0000', '#ff0000'],
                ['#ff0000', '#ff0000', '#ff0000', '#ff0000', '#ff0000'],
                ['', '#ff0000', '#ff0000', '#ff0000', '']
            ];
            drawPattern(35.6820, 139.7320, daruma);
            
            // 刀
            const katana = [
                ['', '', '', '', '', '', '#708090'],
                ['', '', '', '', '', '#708090', '#c0c0c0'],
                ['', '', '', '', '#708090', '#c0c0c0', ''],
                ['', '', '', '#708090', '#c0c0c0', '', ''],
                ['', '', '#708090', '#c0c0c0', '', '', ''],
                ['#8b4513', '#8b4513', '#c0c0c0', '', '', '', ''],
                ['#8b4513', '#8b4513', '', '', '', '', ''],
                ['#ffd700', '#8b4513', '', '', '', '', '']
            ];
            drawPattern(35.6880, 139.7680, katana);
            
            // 忍者
            const ninja = [
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#fdbcb4', '#fdbcb4', '#fdbcb4', ''],
                ['', '#000000', '#fdbcb4', '#000000', ''],
                ['#000000', '#000000', '#000000', '#000000', '#000000'],
                ['', '#000000', '#000000', '#000000', ''],
                ['', '#000000', '', '#000000', ''],
                ['#000000', '#000000', '', '#000000', '#000000']
            ];
            drawPattern(35.6780, 139.7480, ninja);
            
            // 芸者
            const geisha = [
                ['', '#000000', '#000000', '#000000', ''],
                ['#000000', '#ff0000', '#000000', '#ff0000', '#000000'],
                ['', '#ffffff', '#ffffff', '#ffffff', ''],
                ['', '#ffffff', '#ff69b4', '#ffffff', ''],
                ['', '#ffffff', '#ff0000', '#ffffff', ''],
                ['#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4', '#ff69b4'],
                ['#ff69b4', '#ffd700', '#ff69b4', '#ffd700', '#ff69b4'],
                ['', '#ff69b4', '#ff69b4', '#ff69b4', '']
            ];
            drawPattern(35.6920, 139.7580, geisha);
            
            // 盆栽
            const bonsai = [
                ['', '', '#228b22', '#228b22', '#228b22', '', ''],
                ['', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', ''],
                ['#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22'],
                ['', '#228b22', '#228b22', '#228b22', '#228b22', '#228b22', ''],
                ['', '', '#8b4513', '#8b4513', '#8b4513', '', ''],
                ['', '', '', '#8b4513', '', '', ''],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513'],
                ['#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513', '#8b4513']
            ];
            drawPattern(35.6980, 139.7280, bonsai);
            
            totalTileCount = 500; // 初期タイル数
            document.getElementById('statTotal').textContent = totalTileCount;
        }
        
        // パターン描画ヘルパー
        function drawPattern(baseLat, baseLng, pattern) {
            pattern.forEach((row, y) => {
                row.forEach((color, x) => {
                    if (color && color !== '') {
                        const lat = baseLat - (y * TILE_SIZE);
                        const lng = baseLng + (x * TILE_SIZE);
                        drawTile(lat, lng, color, 0.9);
                    }
                });
            });
        }
        
        // 地図クリック処理
        function onMapClick(e) {
            // クールダウンチェック
            if (Date.now() < cooldownEnd) {
                const remaining = Math.ceil((cooldownEnd - Date.now()) / 1000);
                showToast(`Wait ${remaining} seconds!`);
                return;
            }
            
            // タイル描画
            drawTile(e.latlng.lat, e.latlng.lng, currentColor);
            
            // カウント更新
            myTileCount++;
            totalTileCount++;
            document.getElementById('statMine').textContent = myTileCount;
            document.getElementById('statTotal').textContent = totalTileCount;
            
            // クールダウン開始
            startCooldown();
            
            // Google Analytics イベント
            if (typeof gtag !== 'undefined') {
                gtag('event', 'place_tile', {
                    'country': currentCountry,
                    'color': currentColor
                });
            }
        }
        
        // クールダウン処理
        function startCooldown() {
            cooldownEnd = Date.now() + 5000; // 5秒
            const cooldownFill = document.getElementById('cooldownFill');
            const cooldownText = document.getElementById('cooldownText');
            
            const timer = setInterval(() => {
                const remaining = cooldownEnd - Date.now();
                if (remaining <= 0) {
                    cooldownFill.style.width = '0%';
                    cooldownText.textContent = 'Ready!';
                    clearInterval(timer);
                } else {
                    const percent = ((5000 - remaining) / 5000) * 100;
                    cooldownFill.style.width = percent + '%';
                    cooldownText.textContent = Math.ceil(remaining / 1000) + 's';
                }
            }, 100);
        }
        
        // UI設定
        function setupUI() {
            // カラーピッカー
            const picker = document.getElementById('colorPicker');
            const hex = document.getElementById('colorHex');
            
            picker.addEventListener('input', (e) => {
                currentColor = e.target.value;
                hex.value = e.target.value;
            });
            
            hex.addEventListener('input', (e) => {
                if (/^#[0-9a-f]{6}$/i.test(e.target.value)) {
                    currentColor = e.target.value;
                    picker.value = e.target.value;
                }
            });
            
            // 国選択
            document.getElementById('countrySelect').addEventListener('change', (e) => {
                currentCountry = e.target.value;
            });
            
            // タブ切り替え
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    loadRanking(tab.dataset.period);
                });
            });
            
            // 写真モードトグル
            const toggleBtn = document.getElementById('togglePhotoMode');
            const statusText = document.getElementById('photoStatus');
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    photoMode = !photoMode;
                    if (photoMode) {
                        toggleBtn.style.background = '#ff4757';
                        toggleBtn.textContent = 'Exit Photo Mode';
                        statusText.textContent = 'Click on location markers to upload photos';
                        statusText.style.color = '#ff6b6b';
                    } else {
                        toggleBtn.style.background = '#667eea';
                        toggleBtn.textContent = 'Toggle Photo Mode';
                        statusText.textContent = 'Hover over markers to see photos';
                        statusText.style.color = '#ffd700';
                    }
                });
            }
            
            // 保存された写真を読み込み
            const savedPhotos = localStorage.getItem('userPhotos');
            if (savedPhotos) {
                userPhotos = JSON.parse(savedPhotos);
            }
            
            // オンラインカウンター更新
            updateOnlineCount();
            setInterval(updateOnlineCount, 5000);
        }
        
        // オンラインカウント更新
        function updateOnlineCount() {
            const online = 200 + Math.floor(Math.random() * 500);
            document.getElementById('statOnline').textContent = online;
        }
        
        // トースト表示
        function showToast(message) {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ランキング読み込み
        function loadRanking(period) {
            const demoRanking = [
                { country: 'Japan', count: 1234 },
                { country: 'United States', count: 987 },
                { country: 'Korea', count: 654 },
                { country: 'China', count: 432 },
                { country: 'Germany', count: 321 }
            ];
            
            const html = demoRanking.map((item, i) => 
                `<li><span>${i + 1}. ${item.country}</span> <strong>${item.count}</strong></li>`
            ).join('');
            
            document.getElementById('rankingList').innerHTML = html;
        }
        
        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Starting TePlace...');
            initMap();
            setupUI();
            loadRanking('today');
            console.log('TePlace ready!');
        });
    </script>
</body>
</html>