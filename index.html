<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TePlace ‚Äî World Map Territory & Painting Game</title>
  <meta name="description" content="TePlace: paint tiny tiles on the real world map, conquer for your country, and climb the global rankings." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåç</text></svg>">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous" />

  <!-- Optional external CSS -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Critical CSS (fallback if external CSS fails) -->
  <style>
    :root { --bg:#0d1117; --panel:#1f242d; --panel2:#161b22; --txt:#e6edf3; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--txt)}
    .header{display:flex;gap:12px;justify-content:space-between;align-items:center;padding:10px 12px;background:var(--panel2)}
    .logo{font-size:18px;font-weight:800;display:flex;gap:8px;align-items:center}
    .pulse{animation:pulse 2s infinite;display:inline-block}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
    .country-selector label{font-size:13px;opacity:.85;margin-right:6px}
    .country-selector select{height:34px;border-radius:8px;border:1px solid #39424c;background:#0b0f14;color:var(--txt);padding:0 8px}
    .stats{display:flex;gap:12px}
    .stat-item{text-align:center;min-width:70px}
    .stat-value{font-size:16px;font-weight:800}
    .stat-label{font-size:12px;opacity:.75}

    .main-container{display:flex;height:calc(100vh - 56px);position:relative}
    #map{flex:1 1 auto;min-height:360px;background:#111} /* keep height */
    .sidebar{width:340px;background:var(--panel2);overflow-y:auto;padding:10px}
    .sidebar.collapsed{display:none}
    .panel{background:var(--panel);border-radius:12px;padding:10px;margin:10px;box-shadow:0 8px 24px rgba(0,0,0,.15)}
    .panel h3{margin:0 0 8px;font-size:16px}

    .control-buttons{position:absolute;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:1000}
    .control-btn{width:52px;height:52px;border-radius:50%;border:none;cursor:pointer;font-size:20px;box-shadow:0 8px 20px rgba(0,0,0,.25)}

    .cooldown-overlay{position:absolute;left:0;right:0;bottom:0;display:flex;gap:8px;align-items:center;padding:6px 10px;background:#111a;backdrop-filter:blur(6px)}
    .cooldown-progress{flex:1;height:12px;background:#36404a;border-radius:8px;overflow:hidden}
    .cooldown-fill{height:100%;width:0;background:#4ade80;transition:width .1s}
    .notification{position:fixed;top:12px;right:12px;padding:8px 12px;border-radius:10px;display:none;z-index:2000;background:linear-gradient(135deg,rgba(59,130,246,.9),rgba(29,78,216,.9))}
    .notification.show{display:block}

    .btn{height:32px;padding:0 10px;border:none;border-radius:8px;background:#fff;color:#111;font-weight:800;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,.15)}
    .btn.ghost{background:transparent;color:#fff;border:1px solid #39424c}
    .btn.block{width:100%}
    .color-row{display:flex;align-items:center;gap:6px;margin:6px 0}
    .color-row input[type="color"]{width:42px;height:32px;padding:0;border:none;background:transparent}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:6px}
    .text-input{width:100%;height:34px;border-radius:8px;border:1px solid #39424c;background:#0b0f14;color:var(--txt);padding:0 10px}

    .leaderboard-item{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:8px;background:#0b0f14;margin:6px 10px}
    .rank{width:26px;height:26px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;background:#222;font-weight:800}
    .country-info{display:flex;gap:8px;align-items:center}
    .activity-item{padding:6px 8px;background:#0b0f14;border-left:4px solid #888;border-radius:6px;margin:6px 10px}

    @media (max-width:980px){
      .main-container{flex-direction:column;height:auto;min-height:calc(100vh - 56px)}
      #map{height:62vh;min-height:320px}
      .sidebar{width:100%;height:auto}
      .control-buttons{right:12px;bottom:12px}
      .control-btn{width:48px;height:48px;font-size:22px}
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo"><span class="pulse">üåç</span><strong>TePlace</strong> ‚Äî Real World Map Conquest</div>
    <div class="country-selector">
      <label for="countrySelect">Your country:</label>
      <select id="countrySelect"></select>
    </div>
    <div class="stats">
      <div class="stat-item"><div class="stat-value" id="totalTerritories">0</div><div class="stat-label">Total</div></div>
      <div class="stat-item"><div class="stat-value" id="onlineUsers">‚Äî</div><div class="stat-label">Online</div></div>
      <div class="stat-item"><div class="stat-value" id="myTerritories">0</div><div class="stat-label">Mine</div></div>
    </div>
  </header>

  <main class="main-container">
    <div id="map" aria-label="Game map" role="application"></div>

    <aside class="sidebar">
      <div class="panel"><h3>üèÜ World Ranking</h3><div id="leaderboardList"></div></div>
      <div class="panel"><h3>‚öîÔ∏è Battle Log</h3><div id="activityList"></div></div>
      <div class="panel"><h3>üìä Statistics</h3>
        <div id="statsDetails">
          <div class="stat-detail"><small>Hotspot:</small><div id="hotspot">-</div></div>
          <div class="stat-detail"><small>Occupancy:</small><div id="occupancyRate">0%</div></div>
        </div>
      </div>
      <div class="panel"><h3>üåê Occupation Stats</h3><div id="occupationStats"></div></div>

      <div class="panel">
        <h3>üéõÔ∏è Brushes & Settings</h3>
        <div class="grid-2">
          <button class="btn" id="modeSolid">Solid</button>
          <button class="btn" id="modePalette">Palette</button>
        </div>
        <button class="btn block" id="modeRainbow" style="margin-top:6px;">Rainbow</button>

        <label style="margin-top:10px;">Solid color</label>
        <div class="color-row">
          <input type="color" id="solidColor" value="#ff4b4b">
          <button class="btn" id="applySolid">Use</button>
        </div>

        <label>Palette (comma-separated HEX/HSL)</label>
        <input id="paletteInput" class="text-input" placeholder="#ff4b4b,#ffd166,#06d6a0,#118ab2,#8338ec">
        <button class="btn ghost block" id="applyPalette">Update palette</button>

        <hr style="opacity:.2;margin:12px 0;">
        <button class="btn block" id="toggleSidebar">Toggle Sidebar</button>
      </div>
    </aside>

    <div class="control-buttons">
      <button class="control-btn" onclick="toggleGrid()" title="Toggle grid">‚äû</button>
      <button class="control-btn" onclick="toggleHeatmap()" title="Heatmap">üî•</button>
      <button class="control-btn" onclick="centerOnMyCountry()" title="My country">üìç</button>
      <button class="control-btn" onclick="resetView()" title="Reset">üîÑ</button>
    </div>
  </main>

  <div class="cooldown-overlay" id="cooldownBar">
    <span>‚è≥ Next:</span>
    <div class="cooldown-progress"><div class="cooldown-fill" id="cooldownFill"></div></div>
    <span id="cooldownTime">10s</span>
  </div>

  <div class="notification" id="notification"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
  <script src="./script.js" defer></script>
</body>
</html>
