<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TePlace Tokyo - Food & Travel Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
        }
        
        .main-container {
            display: flex;
            height: calc(100vh - 50px);
        }
        
        #map {
            flex: 1;
            width: 100%;
        }
        
        .sidebar {
            width: 300px;
            background: white;
            box-shadow: -2px 0 4px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .place-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .place-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .rating {
            color: #ffa500;
            margin-bottom: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .star-rating {
            display: flex;
            gap: 5px;
            font-size: 24px;
            cursor: pointer;
        }
        
        .star {
            color: #ddd;
        }
        
        .star.active {
            color: #ffa500;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .mobile-menu {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 10px;
                box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-around;
            }
            
            .mobile-menu button {
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
            }
        }
        
        .mobile-menu {
            display: none;
        }
        
        @media (max-width: 768px) {
            .mobile-menu {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üóæ TePlace Tokyo</div>
        <div>
            <select id="categoryFilter" style="padding: 5px; border-radius: 4px;">
                <option value="all">All Categories</option>
                <option value="restaurant">Restaurant</option>
                <option value="cafe">Cafe</option>
                <option value="sightseeing">Sightseeing</option>
                <option value="shopping">Shopping</option>
            </select>
        </div>
    </div>
    
    <div class="main-container">
        <div id="map"></div>
        
        <div class="sidebar">
            <h3>Control Panel</h3>
            <button class="btn" onclick="openAddPlace()">+ Add New Place</button>
            
            <h4 style="margin-top: 20px;">Recent Places</h4>
            <div id="placesList"></div>
        </div>
    </div>
    
    <div class="mobile-menu">
        <button onclick="openAddPlace()">‚ûï</button>
        <button onclick="showPlaces()">üìç</button>
        <button onclick="showTopRated()">‚≠ê</button>
        <button onclick="showMyPlaces()">üë§</button>
    </div>
    
    <div class="modal" id="addPlaceModal">
        <div class="modal-content">
            <h3>Add New Place</h3>
            
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="placeName" placeholder="e.g., Ichiran Ramen">
            </div>
            
            <div class="form-group">
                <label>Category</label>
                <select id="placeCategory">
                    <option value="restaurant">Restaurant</option>
                    <option value="cafe">Cafe</option>
                    <option value="sightseeing">Sightseeing</option>
                    <option value="shopping">Shopping</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Rating</label>
                <div class="star-rating" id="starRating">
                    <span class="star" data-rating="1">‚òÖ</span>
                    <span class="star" data-rating="2">‚òÖ</span>
                    <span class="star" data-rating="3">‚òÖ</span>
                    <span class="star" data-rating="4">‚òÖ</span>
                    <span class="star" data-rating="5">‚òÖ</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Review</label>
                <textarea id="reviewText" rows="3" placeholder="Your review..."></textarea>
            </div>
            
            <button class="btn" onclick="savePlace()">Save Place</button>
            <button class="btn" style="background: #999;" onclick="closeModal()">Cancel</button>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        let map;
        let markers = [];
        let places = [];
        let selectedRating = 0;
        let clickedLocation = null;
        
        // Initialize map
        function initMap() {
            map = L.map('map').setView([35.6762, 139.6503], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            map.on('click', function(e) {
                clickedLocation = e.latlng;
                openAddPlace();
            });
            
            loadPlaces();
        }
        
        // Load places from localStorage
        function loadPlaces() {
            const saved = localStorage.getItem('teplaces');
            if (saved) {
                places = JSON.parse(saved);
                displayPlaces();
            }
            
            // Add some default places
            if (places.length === 0) {
                addDefaultPlaces();
            }
        }
        
        // Add default Tokyo places
        function addDefaultPlaces() {
            const defaults = [
                {
                    name: 'Tokyo Tower',
                    category: 'sightseeing',
                    lat: 35.6586,
                    lng: 139.7454,
                    rating: 5,
                    review: 'Amazing view of Tokyo!'
                },
                {
                    name: 'Sensoji Temple',
                    category: 'sightseeing',
                    lat: 35.7148,
                    lng: 139.7967,
                    rating: 5,
                    review: 'Beautiful historic temple'
                },
                {
                    name: 'Tsukiji Market',
                    category: 'restaurant',
                    lat: 35.6654,
                    lng: 139.7707,
                    rating: 4,
                    review: 'Fresh sushi!'
                }
            ];
            
            places = defaults;
            savePlaces();
            displayPlaces();
        }
        
        // Display places on map
        function displayPlaces() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            // Add new markers
            places.forEach(place => {
                const icon = L.divIcon({
                    html: `<div style="background: ${getCategoryColor(place.category)}; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px;">${getCategoryEmoji(place.category)}</div>`,
                    className: 'custom-marker',
                    iconSize: [30, 30]
                });
                
                const marker = L.marker([place.lat, place.lng], {icon})
                    .addTo(map)
                    .bindPopup(`
                        <div style="min-width: 200px;">
                            <h3>${place.name}</h3>
                            <p>${'‚òÖ'.repeat(place.rating)}</p>
                            <p>${place.review || ''}</p>
                            <p style="color: #666; font-size: 12px;">${place.category}</p>
                        </div>
                    `);
                
                markers.push(marker);
            });
            
            updatePlacesList();
        }
        
        // Get category color
        function getCategoryColor(category) {
            const colors = {
                restaurant: '#ff6b6b',
                cafe: '#a8744f',
                sightseeing: '#4dabf7',
                shopping: '#51cf66'
            };
            return colors[category] || '#868e96';
        }
        
        // Get category emoji
        function getCategoryEmoji(category) {
            const emojis = {
                restaurant: 'üçú',
                cafe: '‚òï',
                sightseeing: 'üèõÔ∏è',
                shopping: 'üõçÔ∏è'
            };
            return emojis[category] || 'üìç';
        }
        
        // Update places list
        function updatePlacesList() {
            const list = document.getElementById('placesList');
            list.innerHTML = places.slice(-5).reverse().map(place => `
                <div class="place-card">
                    <div class="place-title">${getCategoryEmoji(place.category)} ${place.name}</div>
                    <div class="rating">${'‚òÖ'.repeat(place.rating)}</div>
                    <div style="font-size: 12px; color: #666;">${place.review || ''}</div>
                </div>
            `).join('');
        }
        
        // Open add place modal
        function openAddPlace() {
            document.getElementById('addPlaceModal').style.display = 'block';
            
            if (!clickedLocation) {
                alert('Please click on the map to select a location first');
                closeModal();
            }
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('addPlaceModal').style.display = 'none';
            document.getElementById('placeName').value = '';
            document.getElementById('reviewText').value = '';
            selectedRating = 0;
            updateStars();
        }
        
        // Save place
        function savePlace() {
            const name = document.getElementById('placeName').value;
            const category = document.getElementById('placeCategory').value;
            const review = document.getElementById('reviewText').value;
            
            if (!name || selectedRating === 0) {
                alert('Please enter name and rating');
                return;
            }
            
            if (!clickedLocation) {
                alert('Please click on the map to select a location');
                return;
            }
            
            const newPlace = {
                name,
                category,
                lat: clickedLocation.lat,
                lng: clickedLocation.lng,
                rating: selectedRating,
                review,
                date: new Date().toISOString()
            };
            
            places.push(newPlace);
            savePlaces();
            displayPlaces();
            closeModal();
            clickedLocation = null;
        }
        
        // Save to localStorage
        function savePlaces() {
            localStorage.setItem('teplaces', JSON.stringify(places));
        }
        
        // Star rating
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    selectedRating = parseInt(this.dataset.rating);
                    updateStars();
                });
            });
        });
        
        function updateStars() {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }
        
        // Mobile functions
        function showPlaces() {
            alert('Places list - Coming soon!');
        }
        
        function showTopRated() {
            const topRated = [...places].sort((a, b) => b.rating - a.rating).slice(0, 5);
            alert('Top Rated:\n' + topRated.map(p => `${p.name} - ${'‚òÖ'.repeat(p.rating)}`).join('\n'));
        }
        
        function showMyPlaces() {
            alert(`You have added ${places.length} places!`);
        }
        
        // Category filter
        document.getElementById('categoryFilter').addEventListener('change', function(e) {
            const category = e.target.value;
            if (category === 'all') {
                displayPlaces();
            } else {
                // Filter and display
                const filtered = places.filter(p => p.category === category);
                // Simplified filtering display
                alert(`Found ${filtered.length} ${category} places`);
            }
        });
    </script>
</body>
</html>